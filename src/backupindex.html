<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <title>Room Allocation System</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
/* General Body Styling */
      body {
        padding-top: 70px; /* Increased padding for better spacing */
        background-color: #f8f9fa;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Modern font */
        line-height: 1.6; /* Improved readability */
      }

      /* GitHub Link */
      .github-link {
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 1.2rem;
        color: #333; /* Darker color for better visibility */
        transition: color 0.3s ease; /* Smooth hover effect */
      }
      .github-link:hover {
        color: #0d6efd; /* Bootstrap primary blue on hover */
      }

      /* Content Styling */
      .content {
        text-align: center;
        margin-bottom: 40px; /* Added spacing below content */
      }

      h1.display-5 {
        font-weight: 700; /* Bold title */
        color: #2c3e50; /* Slightly darker blue for contrast */
        margin-bottom: 20px; /* Added spacing below heading */
      }

      .description {
        text-align: justify;
        max-width: 700px; /* Slightly wider for better readability */
        margin: 0 auto;
        font-size: 1.1rem;
        color: #555; /* Softer text color */
        line-height: 1.8; /* Improved line height for readability */
        margin-bottom: 30px; /* Added spacing below description */
      }

      /* Buttons */
      button.btn {
        margin: 10px; /* Added spacing between buttons */
        padding: 12px 24px; /* Larger padding for better clickability */
        font-size: 1rem; /* Slightly larger font size */
        border-radius: 8px; /* Rounded corners for a softer look */
        transition: transform 0.2s ease, box-shadow 0.2s ease; /* Hover effects */
      }
      button.btn:hover {
        transform: translateY(-2px); /* Slight lift effect */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
      }

      /* Table Styling */
      table.table {
        margin-top: 30px; /* Added spacing above the table */
        border-radius: 8px; /* Rounded corners for the table */
        overflow: hidden; /* Ensure rounded corners are visible */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
      }
      table.table th,
      table.table td {
        vertical-align: middle; /* Center align content vertically */
        padding: 12px; /* Increased padding for better readability */
        text-align: center; /* Center align text */
      }
      table.table th {
        background-color: #0d6efd; /* Bootstrap primary blue for headers */
        color: white; /* White text for contrast */
        font-weight: 600; /* Semi-bold headers */
      }
      table.table tbody tr:nth-child(even) {
        background-color: #f1f3f5; /* Light gray for even rows */
      }
      table.table tbody tr:hover {
        background-color: #e9ecef; /* Highlight row on hover */
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        body {
          padding-top: 50px; /* Reduced padding for smaller screens */
        }
        h1.display-5 {
          font-size: 1.75rem; /* Smaller heading for mobile */
        }
        .description {
          font-size: 1rem; /* Smaller text for mobile */
        }
        button.btn {
          padding: 10px 20px; /* Reduced padding for mobile */
          font-size: 0.9rem; /* Smaller font size for mobile */
        }
}
    </style>
  </head>
  <body>
    <!-- GitHub Link -->
    <a
      class="github-link text-decoration-none"
      href="https://github.com/calebjubal/mentor-mentee-room-allocation"
      target="_blank"
      rel="noopener noreferrer"
    >
      <img
        src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/github.svg"
        alt="GitHub"
        style="height: 24px; vertical-align: middle;"
      />
      GitHub
    </a>

    <!-- Page Content -->
    <div class="container">
      <div class="content my-4">
        <h1 class="display-5 fw-bold">Room Allocation System</h1>
        <p class="description mt-3">
          This application helps automatically assign rooms to mentors based on their mentee count and block preference.
          By analyzing room capacity and priority blocks (like 'B'), the system ensures efficient allocation. Click below
          to execute the room allocation process using Google Apps Script.
        </p>

        <button id="btn" class="btn btn-primary btn-lg mt-4">Run Allocation</button>
        <button id="btn" class="btn btn-primary btn-lg mt-4">Send Email</button>

        <div class="container mt-5">
          <div id="resultTableContainer"></div>
        </div>
        
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Script -->
    <script>
      function runGoogleScript(serverFuncName) {
        return new Promise((resolve, reject) => {
          google.script.run
            .withSuccessHandler((data) => resolve(data))
            .withFailureHandler((error) => reject(error))[serverFuncName]();
        });
      }

      async function getDataFromServer() {
        try {
          const csvData = await runGoogleScript("allocateRTM");
          alert("Room Allocation Completed!");
          displayCSVAsTable(csvData);
        } catch (error) {
          alert("Error: " + error.message);
        }
      }

      function displayCSVAsTable(csv) {
        const rows = csv.trim().split("\n");
        const table = document.createElement("table");
        table.className = "table table-striped table-bordered";

        rows.forEach((row, index) => {
          const tr = document.createElement("tr");
          row.split(",").forEach(cell => {
            const td = document.createElement(index === 0 ? "th" : "td");
            td.textContent = cell;
            tr.appendChild(td);
          });
          table.appendChild(tr);
        });

        const container = document.getElementById("resultTableContainer");
        container.innerHTML = ""; // Clear existing
        container.appendChild(table);
      }

      document.getElementById("btn").addEventListener("click", getDataFromServer);
    </script>

  </body>
</html>
